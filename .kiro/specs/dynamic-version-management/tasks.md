# 实施计划

- [x] 1. 修改 Dockerfile.base 移除硬编码版本默认值
  - 移除 ARG 指令中的默认值，确保版本必须通过构建参数传入
  - 验证所有版本相关的 ARG 指令都没有默认值
  - 确保环境变量设置正确使用传入的构建参数
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 2. 在构建脚本中添加版本验证逻辑
  - 在 build-base.sh 中添加版本格式验证函数
  - 验证 NODE_VERSION 是有效的数字
  - 验证 CLAUDE_CODE_VERSION 和 CLAUDE_ROUTER_VERSION 符合语义版本格式
  - 验证所有必需的版本变量都存在于 versions.env 中
  - _需求: 2.1, 2.2, 2.3, 2.4_

- [x] 3. 增强错误处理和用户反馈
  - 实现详细的错误消息，指出具体缺失或无效的版本变量
  - 添加版本格式要求的帮助信息
  - 在验证失败时提供修复建议
  - 确保错误消息使用中文显示
  - _需求: 2.1, 2.2, 2.3, 4.3_

- [x] 4. 创建版本一致性测试
  - 编写测试脚本验证 versions.env 和构建结果的版本一致性
  - 测试各种错误场景（缺失文件、无效格式、缺失变量）
  - 验证构建脚本在所有场景下的正确行为
  - 创建自动化测试以防止版本不一致问题
  - _需求: 1.1, 1.2, 2.1, 2.2_

- [x] 5. 更新文档和使用指南
  - 更新 versions.env 文件的注释，说明版本格式要求
  - 创建版本管理最佳实践文档
  - 添加故障排除指南
  - 文档使用中文编写
  - _需求: 4.1, 4.2, 4.3, 4.4_

- [x] 6. 验证向后兼容性
  - 测试现有构建脚本（build.sh, build-full.sh）继续正常工作
  - 确保容器运行时行为保持不变
  - _需求: 3.1, 3.2, 3.3, 3.4_