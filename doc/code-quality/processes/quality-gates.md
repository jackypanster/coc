# 质量门禁标准

## 概述

质量门禁是确保代码质量的自动化检查机制，所有代码在合并到主分支前必须通过这些检查。

## 自动化检查标准

### 1. 代码规范检查 (ESLint)
- **要求**: 零错误
- **警告**: 最多 10 个
- **检查内容**:
  - 代码格式规范
  - 命名规范
  - 语法错误
  - 最佳实践违规

### 2. 复杂度检查
- **圈复杂度**: ≤ 10
- **函数长度**: ≤ 50 行
- **参数数量**: ≤ 5 个
- **嵌套深度**: ≤ 4 层

### 3. 代码重复检查
- **重复率**: ≤ 10%
- **重复行数**: ≤ 20 行连续重复
- **检查范围**: 所有 JavaScript 文件

### 4. 安全检查
- **严重漏洞**: 0 个
- **高危漏洞**: 0 个
- **中等漏洞**: ≤ 5 个

## 质量评分标准

### 整体质量评分计算
- **复杂度评分** (30%): 基于复杂度违规数量
- **重复度评分** (20%): 基于代码重复率
- **安全评分** (30%): 基于安全漏洞数量
- **规范评分** (20%): 基于 ESLint 错误和警告

### 评分等级
- **优秀** (90-100分): 可直接合并
- **良好** (70-89分): 建议改进后合并
- **一般** (50-69分): 必须改进后合并
- **较差** (< 50分): 禁止合并

## 门禁执行流程

### 1. 提交前检查 (Pre-commit)
```bash
# 自动执行的检查
- ESLint 代码规范检查
- 复杂度快速检查
- 安全漏洞检查
- 大文件检查
- 敏感信息检查
```

### 2. 持续集成检查 (CI)
```bash
# GitHub Actions 自动执行
- 完整的 ESLint 检查
- 详细的复杂度分析
- 代码重复检查
- 安全审计
- 质量评分计算
```

### 3. 人工审查检查
- KISS 原则符合性
- 架构设计合理性
- 业务逻辑正确性
- 测试覆盖充分性

## 异常处理

### 紧急情况绕过
在紧急修复情况下，可以使用以下方式绕过部分检查：
```bash
# 绕过 pre-commit 检查（不推荐）
git commit --no-verify

# 在 PR 中说明绕过原因
# 必须在后续 PR 中修复质量问题
```

### 质量债务处理
- 记录在技术债务清单中
- 设定修复时间节点
- 分配责任人跟进
- 定期回顾处理进度

## 工具配置

### ESLint 配置文件
- 位置: `login/.eslintrc.js`
- 包含 KISS 原则相关规则
- 支持自动修复部分问题

### GitHub Actions 配置
- 位置: `.github/workflows/code-quality.yml`
- 自动运行所有质量检查
- 生成详细的质量报告

### 质量配置文件
- 位置: `.quality-config.json`
- 集中管理所有质量标准
- 支持动态调整阈值

## 监控和报告

### 质量趋势监控
- 每日质量评分统计
- 技术债务数量跟踪
- 团队质量改进进度

### 定期质量报告
- 周度质量摘要
- 月度质量分析
- 季度改进计划

## 持续改进

### 标准调整
- 根据团队能力调整标准
- 基于项目需求优化配置
- 参考行业最佳实践

### 工具升级
- 定期更新检查工具
- 集成新的质量检查项
- 优化检查性能和准确性